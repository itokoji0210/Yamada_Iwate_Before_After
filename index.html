<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>岩手県山田町｜新旧3DGS比較（Supersplat埋め込み・フェード既定・iPhone最適化）</title>
<style>
  :root{
    --alpha: 1;          /* フェード不透明度（0〜1）*/
    --split: 50%;        /* 予備：スプリット位置（%） */
    --accent:#2b7cff;
    --radius:16px;
    --panel:#111723;
    --panel2:#1b2232;
    --border:#2a3142;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#0b0e14;color:#e8e8e8;
    font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",Roboto,sans-serif}

  /* ===== ヘッダー（最小限・スクロール時も残す） ===== */
  header{
    position:sticky; top:0; z-index:20;
    display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    padding:10px 12px env(safe-area-inset-right) 10px env(safe-area-inset-left);
    background:rgba(11,14,20,.9); backdrop-filter:blur(8px);
    border-bottom:1px solid var(--border);
  }
  h1{font-size:clamp(14px,2.6vw,18px); margin:0 8px 0 0; line-height:1.2}
  .meta{font-size:12px; opacity:.8}
  .links{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
  .a-btn{
    display:inline-flex; align-items:center; gap:6px;
    border:1px solid var(--border); background:#141a26;
    color:#e8e8e8; text-decoration:none; border-radius:999px;
    padding:8px 12px; font-size:13px
  }

  /* ===== ビュー領域：iPhoneのバー起伏に強い ===== */
  .wrap{
    position:relative;
    height:calc(100svh - 64px); /* ヘッダー分を差し引き：svhでiOSアドレスバー起伏に強い */
    min-height:360px; overflow:hidden;
  }
  .stack{ position:absolute; inset:0 }
  iframe.viewer{
    position:absolute; inset:0; width:100%; height:100%; border:0;
    /* ← 誤操作防止：既定でタッチ・クリック無効 */
    pointer-events:none;
  }
  /* 上レイヤー（新：2025-06-05作成）— 既定はフェード表示 */
  #now { opacity: var(--alpha); clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%) }
  /* スプリットは予備（必要時にクラス付与） */
  .mode-split #now { clip-path: polygon(0 0, var(--split) 0, var(--split) 100%, 0 100%) }

  /* ラベル（視覚的に上下を把握） */
  .badge{
    position:absolute; top:12px; left:12px; z-index:3;
    background:var(--panel2); border:1px solid var(--border);
    border-radius:10px; padding:6px 10px; font-size:12px
  }
  .badge.r{ left:auto; right:12px }

  /* ===== ボトムコントロール（親指で届く位置） ===== */
  .ctrl{
    position:absolute; left:env(safe-area-inset-left); right:env(safe-area-inset-right);
    bottom:calc(12px + env(safe-area-inset-bottom));
    margin:auto; width:min(860px,96vw);
    display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    background:var(--panel2); border:1px solid var(--border);
    border-radius:var(--radius); padding:12px 14px; z-index:5; backdrop-filter:blur(6px)
  }
  .row{display:flex; gap:10px; align-items:center; width:100%}
  .btn{
    border:1px solid var(--border); background:#182132; color:#e8e8e8;
    border-radius:999px; padding:10px 14px; font-size:14px; cursor:pointer
  }
  .btn.primary{outline:2px solid var(--accent)}
  .btn.ghost{background:#10161f}
  /* 大きめスライダー（指で掴みやすく） */
  .slider{ flex:1; display:flex; align-items:center; gap:10px }
  .label{ font-size:12px; opacity:.8; width:36px; text-align:center }
  input[type="range"]{
    -webkit-appearance:none; appearance:none; width:100%; height:16px;
    background:#10161f; border:1px solid var(--border); border-radius:999px; padding:0 8px
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:28px; height:28px; border-radius:50%;
    background:var(--accent); border:none; box-shadow:0 0 0 4px rgba(43,124,255,.18)
  }
  input[type="range"]::-moz-range-thumb{
    width:28px; height:28px; border-radius:50%; background:var(--accent); border:none
  }

  /* デモチップ：最初だけフェード往復を案内（任意で閉じる） */
  .demoTip{
    position:absolute; inset:auto 0 calc(96px + env(safe-area-inset-bottom)) 0;
    margin:auto; width:min(780px,94vw); display:flex; justify-content:center;
    pointer-events:none; z-index:6
  }
  .chip{
    padding:8px 12px; border-radius:999px; font-size:12px;
    background:rgba(20,26,38,.92); border:1px solid var(--border);
    animation: tipfade 4s ease-in-out infinite
  }
  @keyframes tipfade{0%,100%{opacity:.25} 20%,80%{opacity:1}}

  @media (max-width:600px){
    .btn{ padding:9px 12px; font-size:13px }
    .a-btn{ padding:8px 10px; font-size:12px }
    .label{ width:30px; font-size:11px }
  }
</style>
</head>
<body>
  <header>
    <h1>岩手県山田町｜新旧3D比較</h1>
    <div class="meta">既定：フェード（タッチ無効）</div>
    <div class="links">
      <a class="a-btn" href="https://superspl.at/s?id=2b96dad6" target="_blank" rel="noopener">新（2025-06-05）を開く</a>
      <a class="a-btn" href="https://superspl.at/s?id=5812ff07" target="_blank" rel="noopener">旧（2011-03-12）を開く</a>
    </div>
  </header>

  <div id="wrap" class="wrap" role="application" aria-label="3D比較ビュー（タッチ操作は無効）">
    <div class="stack">
      <!-- 旧：2011-03-12 作成に基づく -->
      <iframe id="past" class="viewer" allow="fullscreen; xr-spatial-tracking"
              src="https://superspl.at/s?id=5812ff07"
              title="岩手県山田町（2011-03-12作成に基づく）"></iframe>
      <!-- 新：2025-06-05 作成に基づく（上レイヤー） -->
      <iframe id="now"  class="viewer" allow="fullscreen; xr-spatial-tracking"
              src="https://superspl.at/s?id=2b96dad6"
              title="岩手県山田町（2025-06-05作成に基づく）"></iframe>
    </div>

    <div class="badge">旧：2011-03-12</div>
    <div class="badge r">新：2025-06-05</div>

    <!-- ボトムコントロール（大きめUI） -->
    <div class="ctrl" aria-label="比較コントロール">
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <button id="btnFade"  class="btn primary" aria-pressed="true"  title="フェード表示">フェード</button>
        <button id="btnSplit" class="btn ghost"   aria-pressed="false" title="スライダー表示">スライダー</button>
        <button id="btnToggleTouch" class="btn ghost" title="iframeの操作 有効/無効">操作を一時的に有効化</button>
        <!-- フェードの定位置ショートカット -->
        <div class="slider">
          <span class="label">0%</span>
          <input id="range" type="range" min="0" max="100" value="50" step="1" aria-label="比較位置（フェード/スプリット）" />
          <span class="label">100%</span>
        </div>
        <div class="row" style="gap:6px">
          <button class="btn ghost" id="btn0">旧100%</button>
          <button class="btn ghost" id="btn50">50%</button>
          <button class="btn ghost" id="btn100">新100%</button>
        </div>
      </div>
    </div>

    <!-- 初回だけデモ（2〜3往復） -->
    <div id="demoTip" class="demoTip" aria-hidden="true">
      <div class="chip">デモ：下のスライダーで「旧⇄新」をフェードできます</div>
    </div>
  </div>

<script>
(()=> {
  const root  = document.documentElement;
  const wrap  = document.getElementById('wrap');
  const iframePast = document.getElementById('past');
  const iframeNow  = document.getElementById('now');
  const range = document.getElementById('range');
  const btnFade  = document.getElementById('btnFade');
  const btnSplit = document.getElementById('btnSplit');
  const btnToggleTouch = document.getElementById('btnToggleTouch');
  const btn0 = document.getElementById('btn0');
  const btn50 = document.getElementById('btn50');
  const btn100 = document.getElementById('btn100');
  const demoTip = document.getElementById('demoTip');

  // ========== 表示モード：既定はフェード ==========
  let isSplit = false;
  function applyModeUI(){
    document.body.classList.toggle('mode-split', isSplit);
    btnFade.classList.toggle('primary', !isSplit);
    btnSplit.classList.toggle('primary', isSplit);
    btnFade.setAttribute('aria-pressed', String(!isSplit));
    btnSplit.setAttribute('aria-pressed', String(isSplit));
  }
  function setFade(val){ // val: 0..100
    const a = (val/100).toFixed(3);
    root.style.setProperty('--alpha', a);
    range.value = Math.round(val);
  }
  function setSplit(val){
    root.style.setProperty('--split', val + '%');
    range.value = Math.round(val);
  }
  applyModeUI(); setFade(50);

  range.addEventListener('input', e=>{
    const v = Number(e.target.value);
    if(isSplit) setSplit(v); else setFade(v);
  });
  btnFade.onclick = ()=>{ isSplit = false; applyModeUI(); setFade(range.value) };
  btnSplit.onclick= ()=>{ isSplit = true;  applyModeUI(); setSplit(range.value) };

  // ワンタップでフェード定位置へ（親指で即操作）
  btn0.onclick   = ()=> setFade(0);
  btn50.onclick  = ()=> setFade(50);
  btn100.onclick = ()=> setFade(100);

  // ========== タッチ/クリック禁止（既定） → 一時的に有効化トグル ==========
  let touchBlocked = true;
  function applyTouchBlock(){
    const val = touchBlocked ? 'none' : 'auto';
    iframePast.style.pointerEvents = val;
    iframeNow .style.pointerEvents = val;
    btnToggleTouch.textContent = touchBlocked ? '操作を一時的に有効化' : '操作を再び無効化';
    wrap.setAttribute('aria-label', touchBlocked ? '3D比較ビュー（タッチ操作は無効）' : '3D比較ビュー（タッチ操作は有効）');
  }
  btnToggleTouch.onclick = ()=>{ touchBlocked = !touchBlocked; applyTouchBlock() };
  applyTouchBlock();

  // ========== 起動デモ：フェードで3往復（約9秒） ==========
  let demoRunning = true;
  const stopDemo = ()=>{ demoRunning = false; demoTip.style.display = 'none' };
  ['input','click','touchstart','pointerdown'].forEach(ev=>{
    range.addEventListener(ev, stopDemo, {once:true});
    btnFade.addEventListener(ev, stopDemo, {once:true});
    btnSplit.addEventListener(ev, stopDemo, {once:true});
    btn0.addEventListener(ev, stopDemo, {once:true});
    btn50.addEventListener(ev, stopDemo, {once:true});
    btn100.addEventListener(ev, stopDemo, {once:true});
  });
  let t0 = null; const CYCLES = 3; const PERIOD = 3000;
  const easeInOutSine = x => -(Math.cos(Math.PI * x) - 1) / 2;
  function demoLoop(ts){
    if(!demoRunning) return;
    if(t0===null) t0 = ts;
    const elapsed = ts - t0;
    const progress = Math.min(1, (elapsed % PERIOD) / PERIOD);
    const cyc = Math.floor(elapsed / PERIOD);
    const p = easeInOutSine(progress);
    const val = progress < 0.5 ? (p*2*100) : ((2 - p*2)*100); // 0→100→0
    if(!isSplit){ setFade(val); }
    if(cyc >= CYCLES){ stopDemo(); return }
    requestAnimationFrame(demoLoop);
  }
  requestAnimationFrame(demoLoop);

  // ========== iOSキーボード等による誤縮みを回避（念のため） ==========
  window.addEventListener('resize', ()=>{
    // 何もしなくても svh/dvh が効くが、古い端末向けに再レイアウトを促す
    document.body.style.transform = 'translateZ(0)'; // GPU促進トリガ
    setTimeout(()=>{ document.body.style.transform = '' }, 200);
  });
})();
</script>
</body>
</html>
